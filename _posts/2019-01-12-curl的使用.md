---
layout: post
title: curlçš„ç®€ä»‹å’Œä½¿ç”¨
categories: [linux, network]
description: curlçš„ç®€ä»‹å’Œä½¿ç”¨
keywords: linux, curl, network
---

# [è½¬]curlçš„ç®€ä»‹å’Œä½¿ç”¨

æœ¬æ–‡è½¬è½½è‡ª[curlç½‘ç«™å¼€å‘æŒ‡å—](http://www.ruanyifeng.com/blog/2011/09/curl.html),åšäº†å¾ˆå°çš„æ”¹åŠ¨ï¼Œéµä»è‡ªç”±è½¬è½½åŸåˆ™ã€‚

## What's curl used for?

curl is used in command lines or scripts to transfer data. It is also used in cars, television sets, routers, printers, audio equipment, mobile phones, tablets, settop boxes, media players and is the internet transfer backbone for thousands of software applications affecting billions of humans daily.

curlæ˜¯ä¸€ä¸ªè¢«ç”¨åœ¨å‘½ä»¤è¡Œæˆ–è€…è„šæœ¬ä¸­ï¼Œç”¨æ¥ä¼ è¾“æ•°æ®çš„å·¥å…·ã€‚å®ƒè¿˜è¢«è¿ç”¨äº ğŸš— ä¸Šï¼ŒğŸ“º ä¸Šï¼Œè·¯ç”±å™¨ä¸Šï¼ŒğŸ–¨ï¸ ä¸Šï¼ŒéŸ³å“è®¾å¤‡ä¸Šï¼ŒğŸ“± ä¸Šï¼Œå¹³æ¿ç”µè„‘ä¸Šï¼Œæœºé¡¶ç›’ä¸Šï¼Œåª’ä½“æ’­æ”¾å™¨ä¸Šï¼Œä»¥åŠæ•°ä»¥ä¸‡è®¡ï¼Œå½±å“ç€ä¸Šç™¾ä¸‡å¹´çš„äººä»¬æ—¥å¸¸ç”Ÿæ´»çš„åŸºäºç½‘ç»œçš„è½¯ä»¶ã€‚

curl æ˜¯ä¸€ç§å‘½ä»¤è¡Œå·¥å…·ï¼Œä½œç”¨æ˜¯å‘å‡ºç½‘ç»œè¯·æ±‚ï¼Œç„¶åå¾—åˆ°å’Œæå–æ•°æ®ï¼Œæ˜¾ç¤ºåœ¨"æ ‡å‡†è¾“å‡º"ï¼ˆstdoutï¼‰ä¸Šé¢ã€‚

å®ƒæ”¯æŒå¤šç§åè®®ï¼Œä¸‹é¢ä¸¾ä¾‹è®²è§£å¦‚ä½•å°†å®ƒç”¨äºç½‘ç«™å¼€å‘ã€‚

## ä¸€ã€æŸ¥çœ‹ç½‘é¡µæºç 

ç›´æ¥åœ¨ curl å‘½ä»¤ååŠ ä¸Šç½‘å€ï¼Œå°±å¯ä»¥çœ‹åˆ°ç½‘é¡µæºç ã€‚æˆ‘ä»¬ä»¥ç½‘å€ www.sina.com ä¸ºä¾‹ï¼ˆé€‰æ‹©è¯¥ç½‘å€ï¼Œä¸»è¦å› ä¸ºå®ƒçš„ç½‘é¡µä»£ç è¾ƒçŸ­ï¼‰ï¼š

`$ curl www.sina.com`

```
ã€€ã€€<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 2.0//EN">
ã€€ã€€<html><head>
ã€€ã€€<title>301 Moved Permanently</title>
ã€€ã€€</head><body>
ã€€ã€€<h1>Moved Permanently</h1>
ã€€ã€€<p>The document has moved <a href="http://www.sina.com.cn/">here</a>.</p>
ã€€ã€€</body></html>
```

å¦‚æœè¦æŠŠè¿™ä¸ªç½‘é¡µä¿å­˜ä¸‹æ¥ï¼Œå¯ä»¥ä½¿ç”¨` -o `å‚æ•°ï¼Œè¿™å°±ç›¸å½“äºä½¿ç”¨ wget å‘½ä»¤äº†ã€‚

`$ curl -o [æ–‡ä»¶å] www.sina.com`

## äºŒã€è‡ªåŠ¨è·³è½¬

æœ‰çš„ç½‘å€æ˜¯è‡ªåŠ¨è·³è½¬çš„(é‡å®šå‘)ã€‚ä½¿ç”¨` -L `å‚æ•°ï¼Œcurl å°±ä¼šè·³è½¬åˆ°æ–°çš„ç½‘å€ã€‚

`$ curl -L www.sina.com`

é”®å…¥ä¸Šé¢çš„å‘½ä»¤ï¼Œç»“æœå°±è‡ªåŠ¨è·³è½¬ä¸º www.sina.com.cnã€‚

## ä¸‰ã€æ˜¾ç¤ºå¤´ä¿¡æ¯

` -i `å‚æ•°å¯ä»¥æ˜¾ç¤º http response çš„å¤´ä¿¡æ¯ï¼Œè¿åŒç½‘é¡µä»£ç ä¸€èµ·ã€‚

`$ curl -i www.sina.com`

```
ã€€ã€€HTTP/1.0 301 Moved Permanently
ã€€ã€€Date: Sat, 03 Sep 2011 23:44:10 GMT
ã€€ã€€Server: Apache/2.0.54 (Unix)
ã€€ã€€Location: http://www.sina.com.cn/
ã€€ã€€Cache-Control: max-age=3600
ã€€ã€€Expires: Sun, 04 Sep 2011 00:44:10 GMT
ã€€ã€€Vary: Accept-Encoding
ã€€ã€€Content-Length: 231
ã€€ã€€Content-Type: text/html; charset=iso-8859-1
ã€€ã€€Age: 3239
ã€€ã€€X-Cache: HIT from sh201-9.sina.com.cn
ã€€ã€€Connection: close

ã€€ã€€<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 2.0//EN">
ã€€ã€€<html><head>
ã€€ã€€<title>301 Moved Permanently</title>
ã€€ã€€</head><body>
ã€€ã€€<h1>Moved Permanently</h1>
ã€€ã€€<p>The document has moved <a href="http://www.sina.com.cn/">here</a>.</p>
ã€€ã€€</body></html>
```

` -I `å‚æ•°åˆ™æ˜¯åªæ˜¾ç¤º http response çš„å¤´ä¿¡æ¯ã€‚

## å››ã€æ˜¾ç¤ºé€šä¿¡è¿‡ç¨‹

` -v `å‚æ•°å¯ä»¥æ˜¾ç¤ºä¸€æ¬¡ http é€šä¿¡çš„æ•´ä¸ªè¿‡ç¨‹ï¼ŒåŒ…æ‹¬ç«¯å£è¿æ¥å’Œ http request å¤´ä¿¡æ¯ã€‚

`$ curl -v www.sina.com`

```
ã€€ã€€* About to connect() to www.sina.com port 80 (#0)
ã€€ã€€* Trying 61.172.201.195... connected
ã€€ã€€* Connected to www.sina.com (61.172.201.195) port 80 (#0)
ã€€ã€€> GET / HTTP/1.1
ã€€ã€€> User-Agent: curl/7.21.3 (i686-pc-linux-gnu) libcurl/7.21.3 OpenSSL/0.9.8o zlib/1.2.3.4 libidn/1.18
ã€€ã€€> Host: www.sina.com
ã€€ã€€> Accept: */*
ã€€ã€€> 
ã€€ã€€* HTTP 1.0, assume close after body
ã€€ã€€< HTTP/1.0 301 Moved Permanently
ã€€ã€€< Date: Sun, 04 Sep 2011 00:42:39 GMT
ã€€ã€€< Server: Apache/2.0.54 (Unix)
ã€€ã€€< Location: http://www.sina.com.cn/
ã€€ã€€< Cache-Control: max-age=3600
ã€€ã€€< Expires: Sun, 04 Sep 2011 01:42:39 GMT
ã€€ã€€< Vary: Accept-Encoding
ã€€ã€€< Content-Length: 231
ã€€ã€€< Content-Type: text/html; charset=iso-8859-1
ã€€ã€€< X-Cache: MISS from sh201-19.sina.com.cn
ã€€ã€€< Connection: close
ã€€ã€€< 
ã€€ã€€<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 2.0//EN">
ã€€ã€€<html><head>
ã€€ã€€<title>301 Moved Permanently</title>
ã€€ã€€</head><body>
ã€€ã€€<h1>Moved Permanently</h1>
ã€€ã€€<p>The document has moved <a href="http://www.sina.com.cn/">here</a>.</p>
ã€€ã€€</body></html>
ã€€ã€€* Closing connection #0
```

å¦‚æœä½ è§‰å¾—ä¸Šé¢çš„ä¿¡æ¯è¿˜ä¸å¤Ÿï¼Œé‚£ä¹ˆä¸‹é¢çš„å‘½ä»¤å¯ä»¥æŸ¥çœ‹æ›´è¯¦ç»†çš„é€šä¿¡è¿‡ç¨‹ã€‚

`$ curl --trace output.txt www.sina.com`

æˆ–è€…

`$ curl --trace-ascii output.txt www.sina.com`

è¿è¡Œåï¼Œè¯·æ‰“å¼€ output.txt æ–‡ä»¶æŸ¥çœ‹ã€‚

## äº”ã€å‘é€è¡¨å•ä¿¡æ¯

å‘é€è¡¨å•ä¿¡æ¯æœ‰ GET å’Œ POST ä¸¤ç§æ–¹æ³•ã€‚GET æ–¹æ³•ç›¸å¯¹ç®€å•ï¼Œåªè¦æŠŠæ•°æ®é™„åœ¨ç½‘å€åé¢å°±è¡Œã€‚

`$ curl example.com/form.cgi?data=xxx`

POST æ–¹æ³•å¿…é¡»æŠŠæ•°æ®å’Œç½‘å€åˆ†å¼€ï¼Œcurl å°±è¦ç”¨åˆ°--dataå‚æ•°ã€‚

`$ curl -X POST --data "data=xxx" example.com/form.cgi`

å¦‚æœä½ çš„æ•°æ®æ²¡æœ‰ç»è¿‡è¡¨å•ç¼–ç ï¼Œè¿˜å¯ä»¥è®© curl ä¸ºä½ ç¼–ç ï¼Œå‚æ•°æ˜¯`--data-urlencode`ã€‚

`$ curl -X POST--data-urlencode "date=April 1" example.com/form.cgi`

## å…­ã€HTTP åŠ¨è¯

curl é»˜è®¤çš„ HTTP åŠ¨è¯æ˜¯ GETï¼Œä½¿ç”¨` -X `å‚æ•°å¯ä»¥æ”¯æŒå…¶ä»–åŠ¨è¯ã€‚

`$ curl -X POST www.example.com`

`$ curl -X DELETE www.example.com`

## ä¸ƒã€æ–‡ä»¶ä¸Šä¼ 

å‡å®šæ–‡ä»¶ä¸Šä¼ çš„è¡¨å•æ˜¯ä¸‹é¢è¿™æ ·ï¼š

```
ã€€ã€€<form method="POST" enctype='multipart/form-data' action="upload.cgi">
ã€€ã€€ã€€ã€€<input type=file name=upload>
ã€€ã€€ã€€ã€€<input type=submit name=press value="OK">
ã€€ã€€</form>
```

ä½ å¯ä»¥ç”¨ curl è¿™æ ·ä¸Šä¼ æ–‡ä»¶ï¼š

`$ curl --form upload=@localfilename --form press=OK [URL]`

## å…«ã€Referer å­—æ®µ

æœ‰æ—¶ä½ éœ€è¦åœ¨ http request å¤´ä¿¡æ¯ä¸­ï¼Œæä¾›ä¸€ä¸ª referer å­—æ®µï¼Œè¡¨ç¤ºä½ æ˜¯ä»å“ªé‡Œè·³è½¬è¿‡æ¥çš„ã€‚

`$ curl --referer http://www.example.com http://www.example.com`

## ä¹ã€User Agent å­—æ®µ

è¿™ä¸ªå­—æ®µæ˜¯ç”¨æ¥è¡¨ç¤ºå®¢æˆ·ç«¯çš„è®¾å¤‡ä¿¡æ¯ã€‚æœåŠ¡å™¨æœ‰æ—¶ä¼šæ ¹æ®è¿™ä¸ªå­—æ®µï¼Œé’ˆå¯¹ä¸åŒè®¾å¤‡ï¼Œè¿”å›ä¸åŒæ ¼å¼çš„ç½‘é¡µï¼Œæ¯”å¦‚æ‰‹æœºç‰ˆå’Œæ¡Œé¢ç‰ˆã€‚

iPhone4 çš„ User Agent æ˜¯

```
ã€€ã€€Mozilla/5.0 (iPhone; U; CPU iPhone OS 4_0 like Mac 
ã€€ã€€OS X; en-us) AppleWebKit/532.9 (KHTML, like Gecko) 
ã€€ã€€Version/4.0.5 Mobile/8A293 Safari/6531.22.7
```

curlå¯ä»¥è¿™æ ·æ¨¡æ‹Ÿï¼š

`$ curl --user-agent "[User Agent]" [URL]`

## åã€cookie

ä½¿ç”¨` --cookie `å‚æ•°ï¼Œå¯ä»¥è®© curl å‘é€ cookieã€‚

`$ curl --cookie "name=xxx" www.example.com`

è‡³äºå…·ä½“çš„cookieçš„å€¼ï¼Œå¯ä»¥ä» http response å¤´ä¿¡æ¯çš„` Set-Cookie `å­—æ®µä¸­å¾—åˆ°ã€‚

` -c cookie-file `å¯ä»¥ä¿å­˜æœåŠ¡å™¨è¿”å›çš„ cookie åˆ°æ–‡ä»¶ï¼Œ` -b cookie-file `å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ–‡ä»¶ä½œä¸º cookie ä¿¡æ¯ï¼Œè¿›è¡Œåç»­çš„è¯·æ±‚ã€‚

`$ curl -c cookies http://example.com`
`$ curl -b cookies http://example.com`

## åä¸€ã€å¢åŠ å¤´ä¿¡æ¯

æœ‰æ—¶éœ€è¦åœ¨ http request ä¹‹ä¸­ï¼Œè‡ªè¡Œå¢åŠ ä¸€ä¸ªå¤´ä¿¡æ¯ã€‚` --header `å‚æ•°å°±å¯ä»¥èµ·åˆ°è¿™ä¸ªä½œç”¨ã€‚

`$ curl --header "Content-Type:application/json" http://example.com`

## åäºŒã€HTTP è®¤è¯

æœ‰äº›ç½‘åŸŸéœ€è¦ HTTP è®¤è¯ï¼Œè¿™æ—¶ curl éœ€è¦ç”¨åˆ°` --user `å‚æ•°ã€‚

`$ curl --user name:password example.com`


## ã€å‚è€ƒèµ„æ–™ã€‘

- [Using cURL to automate HTTP jobs](https://curl.haxx.se/docs/httpscripting.html)

- [curlç½‘ç«™å¼€å‘æŒ‡å—](http://www.ruanyifeng.com/blog/2011/09/curl.html)

